<Window
    x:Class="HostComputer.Views.StartupWindow"
    xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
    xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
    xmlns:i="http://schemas.microsoft.com/xaml/behaviors"
    xmlns:viewModels="clr-namespace:HostComputer.ViewModels"
    Title="系统启动"
    Width="600"
    Height="400"
    AllowsTransparency="True"
    Background="Transparent"
    Loaded="StartupWindow_Loaded"
    WindowStartupLocation="CenterScreen"
    WindowStyle="None">
    <Window.Resources>
        <!-- 深色现代滚动条 -->
        <Style TargetType="ScrollBar">
            <Setter Property="Template">
                <Setter.Value>
                    <ControlTemplate TargetType="ScrollBar">
                        <Grid>
                            <Grid.RowDefinitions>
                                <RowDefinition Height="0.00001*"/>
                                <RowDefinition Height="*"/>
                                <RowDefinition Height="0.00001*"/>
                            </Grid.RowDefinitions>

                            <Rectangle Grid.Row="1" Fill="#2b2b2b"/>

                            <Track x:Name="PART_Track"
                               Grid.Row="1"
                               IsDirectionReversed="True">
                                <Track.Thumb>
                                    <Thumb Background="#444"
                                      
                                       Height="40" />
                                </Track.Thumb>
                            </Track>
                        </Grid>
                    </ControlTemplate>
                </Setter.Value>
            </Setter>
        </Style>

        <!-- ListBox 禁用默认选择效果 -->
        <Style TargetType="ListBoxItem">
            <Setter Property="Background" Value="Transparent"/>
            <Setter Property="BorderThickness" Value="0"/>
            <Setter Property="Padding" Value="0"/>
            <Setter Property="FocusVisualStyle" Value="{x:Null}"/>
            <Setter Property="Template">
                <Setter.Value>
                    <ControlTemplate TargetType="ListBoxItem">
                        <ContentPresenter/>
                    </ControlTemplate>
                </Setter.Value>
            </Setter>
        </Style>
    </Window.Resources>

    <!--  直接在窗口处理Loaded事件  -->

    <!--  注意：这里不能直接实例化 ViewModel，因为需要参数  -->
    <!--  我们将在代码后台创建并设置 DataContext  -->

    <!--  现代风格的启动窗口  -->
    <Border
        Background="#1a1a1a"
        BorderBrush="#333"
        BorderThickness="1"
        CornerRadius="15">
        <Grid Margin="20">
            <Grid.RowDefinitions>
                <RowDefinition Height="Auto" />
                <RowDefinition Height="*" />
                <RowDefinition Height="Auto" />
            </Grid.RowDefinitions>

            <!--  标题区域  -->
            <StackPanel Grid.Row="0" Margin="0,0,0,20">
                <TextBlock
                    FontSize="24"
                    FontWeight="SemiBold"
                    Foreground="White"
                    Text="系统初始化" />
                <TextBlock
                    x:Name="txtStatus"
                    Margin="0,5,0,0"
                    Foreground="#aaa"
                    Text="{Binding StatusText}" />
            </StackPanel>

            <!--  进度显示区域  -->
            <Border
                Grid.Row="1"
                Padding="15"
                Background="#252525"
                CornerRadius="10">
                <Grid>
                    <Grid.RowDefinitions>
                        <RowDefinition Height="Auto" />
                        <RowDefinition Height="*" />
                        <RowDefinition Height="Auto" />
                    </Grid.RowDefinitions>

                    <!--  总体进度  -->
                    <StackPanel Grid.Row="0" Margin="0,0,0,15">
                        <TextBlock
                            FontSize="13"
                            Foreground="#ccc"
                            Text="总体进度" />
                        <ProgressBar
                            x:Name="pbOverall"
                            Height="10"
                            Margin="0,5,0,0"
                            Background="#333"
                            Foreground="#0078d4"
                            Value="{Binding OverallProgress}" />
                        <TextBlock
                            x:Name="txtProgress"
                            Margin="0,2,0,0"
                            HorizontalAlignment="Right"
                            FontSize="11"
                            Foreground="#0078d4"
                            Text="{Binding ProgressText}" />
                    </StackPanel>

                    <!--  模块列表  -->
                    <Border
                        Grid.Row="1"
                        Padding="10"
                        Background="#1e1e1e"
                        CornerRadius="8">
                        <ListBox
                            x:Name="lbModules"
                            Background="Transparent"
                            Loaded="ModuleList_Loaded"
                            BorderThickness="0"
                            ItemsSource="{Binding Modules}"
                            ScrollViewer.VerticalScrollBarVisibility="Auto">
                            <ListBox.ItemTemplate>
                                <DataTemplate>
                                    <Border
                                        Margin="0,2"
                                        Padding="10,8"
                                        Background="#2a2a2a"
                                        CornerRadius="6">
                                        <Grid>
                                            <Grid.ColumnDefinitions>
                                                <ColumnDefinition Width="*" />
                                                <ColumnDefinition Width="Auto" />
                                                <ColumnDefinition Width="100" />
                                            </Grid.ColumnDefinitions>

                                            <StackPanel Grid.Column="0">
                                                <TextBlock
                                                    FontSize="13"
                                                    Foreground="White"
                                                    Text="{Binding Name}" />
                                                <TextBlock
                                                    Margin="0,2,0,0"
                                                    FontSize="11"
                                                    Foreground="#aaa"
                                                    Text="{Binding Message}" />
                                            </StackPanel>

                                            <TextBlock
                                                Grid.Column="1"
                                                Margin="0,0,15,0"
                                                VerticalAlignment="Center"
                                                Foreground="{Binding StatusColor}"
                                                Text="{Binding Status}" />

                                            <TextBlock
                                                Grid.Column="2"
                                                HorizontalAlignment="Right"
                                                VerticalAlignment="Center"
                                                Foreground="#888"
                                                Text="{Binding Duration}" />
                                        </Grid>
                                    </Border>
                                </DataTemplate>
                            </ListBox.ItemTemplate>
                        </ListBox>
                    </Border>

                    <!--  耗时统计  -->
                    <StackPanel
                        Grid.Row="2"
                        Margin="0,10,0,0"
                        HorizontalAlignment="Right"
                        Orientation="Horizontal">
                        <TextBlock Foreground="#888" Text="已耗时: " />
                        <TextBlock
                            x:Name="txtElapsedTime"
                            Foreground="#ccc"
                            Text="{Binding ElapsedTime}" />
                    </StackPanel>
                </Grid>
            </Border>

            <!--  底部信息  -->
            <StackPanel
                Grid.Row="2"
                Margin="0,20,0,0"
                HorizontalAlignment="Center"
                Orientation="Horizontal">
                <TextBlock
                    FontSize="11"
                    Foreground="#666"
                    Text="Host Computer System" />
                <TextBlock Foreground="#666" Text=" • " />
                <TextBlock Foreground="#666" Text="版本 1.0.0" />
            </StackPanel>
        </Grid>
    </Border>
</Window>