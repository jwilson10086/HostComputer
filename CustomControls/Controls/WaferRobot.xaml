<UserControl
    x:Class="CustomControls.Controls.WaferRobot"
    xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
    xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
    xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
    xmlns:local="clr-namespace:CustomControls.Controls"
    xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
    Width="300"
    Height="300"
    mc:Ignorable="d">

    <UserControl.Resources>
        <!--  渐变资源  -->
        <LinearGradientBrush x:Key="RobotArmGradient" StartPoint="0,0.5" EndPoint="1,0.5">
            <GradientStop Offset="0" Color="#FFD0D0D0" />
            <GradientStop Offset="0.5" Color="#FFF5F5F5" />
            <GradientStop Offset="1" Color="#F6F6F6" />
        </LinearGradientBrush>

        <RadialGradientBrush x:Key="RobotBaseGradient">
            <GradientStop Offset="0" Color="#E4E7EB" />
            <GradientStop Offset="1" Color="#FFA0A0A0" />
        </RadialGradientBrush>

        <RadialGradientBrush x:Key="RobotJointGradient">
            <GradientStop Offset="0.0" Color="#FFE9EEF2" />
            <GradientStop Offset="0.9" Color="#FFB5C2CB" />
            <GradientStop Offset="1" Color="#FF808080" />
        </RadialGradientBrush>

        <RadialGradientBrush x:Key="WaferGradient">
            <GradientStop Offset="0.0" Color="#FFE9EEF2" />
            <GradientStop Offset="0.9" Color="#FFB5C2CB" />
            <GradientStop Offset="1" Color="#FF808080" />
        </RadialGradientBrush>

        <SolidColorBrush x:Key="ToolFill" Color="#C0C0C0" />
    </UserControl.Resources>

    <Viewbox Stretch="Uniform">
        <Grid MouseRightButtonUp="OnRobotRightClick">
            <Grid.ColumnDefinitions>
                <ColumnDefinition />
                <ColumnDefinition Width="Auto" />
            </Grid.ColumnDefinitions>

            <!--  机械臂视图  -->
            <Viewbox
                Width="550"
                Height="550"
                Stretch="Uniform">
                <Grid Width="650" Height="500">
                    <Canvas HorizontalAlignment="Center" VerticalAlignment="Center">
                        <!--  整体旋转容器  -->
                        <Canvas x:Name="BaseRotationContainer">
                            <Canvas.RenderTransform>
                                <TransformGroup>
                                    <TranslateTransform />
                                    <ScaleTransform />
                                    <!--  Bind BaseRotate.Angle to BaseAngle DP  -->
                                    <RotateTransform x:Name="BaseRotate" Angle="{Binding BaseAngle, RelativeSource={RelativeSource AncestorType=UserControl}}" />
                                </TransformGroup>
                            </Canvas.RenderTransform>

                            <!--  中心关节  -->
                            <Ellipse
                                Canvas.Left="-110"
                                Canvas.Top="-110"
                                Width="220"
                                Height="220"
                                Fill="{StaticResource RobotBaseGradient}" />

                            <!--  左臂 Arm1_1 (上臂) - ZIndex 1  -->
                            <Canvas
                                x:Name="Arm1_1"
                                Canvas.Left="-34"
                                Canvas.Top="0"
                                Panel.ZIndex="1"
                                RenderTransformOrigin="0,0">
                                <Canvas.RenderTransform>
                                    <TransformGroup>
                                        <TranslateTransform />
                                        <ScaleTransform />
                                        <!--  Bind to Arm1_1Angle DP  -->
                                        <RotateTransform x:Name="Arm1_1_Rotate" Angle="0" />
                                    </TransformGroup>
                                </Canvas.RenderTransform>

                                <!--  大臂底部圆  -->
                                <Ellipse
                                    Canvas.Left="-34"
                                    Canvas.Top="-34"
                                    Width="68"
                                    Height="68"
                                    Fill="{StaticResource RobotJointGradient}"
                                    Stroke="#FF666666"
                                    StrokeThickness="1" />

                                <!--  大臂主体  -->
                                <Path
                                    Data="M 34 0 L 28 200 L -28 200 L -34 -0 A 34 34 -270 0 1 34 0 Z"
                                    Fill="{StaticResource RobotArmGradient}"
                                    Stroke="#FF666666"
                                    StrokeLineJoin="Round"
                                    StrokeThickness="1" />

                                <!--  上端平口  -->
                                <Rectangle
                                    Canvas.Left="-28"
                                    Canvas.Top="200"
                                    Width="56"
                                    Height="0"
                                    Fill="{StaticResource RobotArmGradient}" />

                                <!--  小臂 Arm1_2 (嵌套在 Arm1_1 内部，相对 ZIndex 10)  -->
                                <Canvas
                                    x:Name="Arm1_2"
                                    Canvas.Left="0"
                                    Canvas.Top="200"
                                    Panel.ZIndex="10"
                                    RenderTransformOrigin="0,0">
                                    <Canvas.RenderTransform>
                                        <TransformGroup>
                                            <TranslateTransform />
                                            <ScaleTransform />
                                            <!--  Bind to Arm1_2Angle DP  -->
                                            <RotateTransform x:Name="Arm1_2_Rotate" Angle="{Binding Arm1_2Angle, RelativeSource={RelativeSource AncestorType=UserControl}}" />
                                        </TransformGroup>
                                    </Canvas.RenderTransform>

                                    <!--  小臂底部圆  -->
                                    <Ellipse
                                        Canvas.Left="-28"
                                        Canvas.Top="-28"
                                        Width="56"
                                        Height="56"
                                        Fill="{StaticResource RobotJointGradient}"
                                        Stroke="#FF666666"
                                        StrokeThickness="1" />

                                    <!--  小臂主体  -->
                                    <Path
                                        Canvas.Left="0.5"
                                        HorizontalAlignment="Center"
                                        VerticalAlignment="Center"
                                        Data="M 28 0.0001 L 28 234 L -28 234 L -28 -0.0001 A 28 28 90 0 1 28 0.0001 Z"
                                        Fill="{StaticResource RobotArmGradient}"
                                        Stroke="#FF666666"
                                        StrokeLineJoin="Round"
                                        StrokeThickness="1" />

                                    <!--  上端平口  -->
                                    <Rectangle
                                        Canvas.Left="-28"
                                        Canvas.Top="234"
                                        Width="56"
                                        Height="0"
                                        HorizontalAlignment="Left"
                                        VerticalAlignment="Top"
                                        Fill="{StaticResource RobotArmGradient}" />

                                    <!--  工具 Arm1_3 (嵌套在 Arm1_2 内部，相对 ZIndex 20)  -->
                                    <Canvas
                                        x:Name="Arm1_3"
                                        Canvas.Left="0"
                                        Canvas.Top="236"
                                        Panel.ZIndex="20"
                                        RenderTransformOrigin="0,0">
                                        <Canvas.RenderTransform>
                                            <TransformGroup>
                                                <TranslateTransform />
                                                <ScaleTransform />
                                                <!--  Bind to Arm1_3Angle DP  -->
                                                <RotateTransform x:Name="Arm1_3_Rotate" Angle="{Binding Arm1_3Angle, RelativeSource={RelativeSource AncestorType=UserControl}}" />
                                            </TransformGroup>
                                        </Canvas.RenderTransform>

                                        <!--  工具底座  -->
                                        <Path
                                            Data="M 38 -80 L -38 -80 L -38 0 A 38 38 270 0 0 38 1 Z "
                                            Fill="{StaticResource RobotArmGradient}"
                                            Stroke="#FF666666"
                                            StrokeThickness="1" />

                                        <!--  工具中心关节  -->
                                        <Ellipse
                                            Canvas.Left="-15"
                                            Canvas.Top="-15"
                                            Width="30"
                                            Height="30"
                                            Fill="{StaticResource RobotJointGradient}" />

                                        <!--  工具叉形  -->
                                        <Path
                                            Canvas.Left="0"
                                            Canvas.Top="-80"
                                            Data="M -20 0 L -20 -120 L -30 -140 L -30 -220 L -20 -220 L -10 -180 L 10 -180 L 20 -220 L 30 -220 L 30 -140 L 20 -120 L 20 0 Z"
                                            Fill="{StaticResource ToolFill}"
                                            Stroke="#FF666666"
                                            StrokeThickness="1" />
                                        <local:WaferControl
                                            x:Name="WaferCtrl_Lower"
                                            Canvas.Left="-60"
                                            Canvas.Top="-300"
                                            Width="120"
                                            Height="120"
                                            FontColor="Black"
                                            Status="Fail"
                                            WaferFontFamily="Consolas"
                                            WaferFontSize="18"
                                            WaferFontWeight="Bold"
                                            WaferLabel="LOT234-25"
                                            WaferVisible="True" />
                                    </Canvas>
                                </Canvas>
                            </Canvas>

                            <!--  右臂 Arm2_1 (上臂) - ZIndex 1  -->
                            <Canvas
                                x:Name="Arm2_1"
                                Canvas.Left="34"
                                Canvas.Top="0"
                                Panel.ZIndex="1"
                                RenderTransformOrigin="0,0">
                                <Canvas.RenderTransform>
                                    <TransformGroup>
                                        <TranslateTransform />
                                        <ScaleTransform ScaleX="-1" />
                                        <!--  镜像 + bind to Arm2_1Angle DP; rename to Arm2_1_Rotate  -->
                                        <RotateTransform x:Name="Arm2_1_Rotate" Angle="{Binding Arm2_1Angle, RelativeSource={RelativeSource AncestorType=UserControl}}" />
                                    </TransformGroup>
                                </Canvas.RenderTransform>

                                <!--  大臂底部圆  -->
                                <Ellipse
                                    Canvas.Left="-34"
                                    Canvas.Top="-34"
                                    Width="68"
                                    Height="68"
                                    Fill="{StaticResource RobotJointGradient}"
                                    Stroke="#FF666666"
                                    StrokeThickness="1" />

                                <!--  大臂主体  -->
                                <Path
                                    Data="M 34 0 L 28 200 L -28 200 L -34 0 A 34 34 -270 0 1 34 0 Z"
                                    Fill="{StaticResource RobotArmGradient}"
                                    Stroke="#FF666666"
                                    StrokeThickness="1" />

                                <!--  上端平口  -->
                                <Rectangle
                                    Canvas.Left="-28"
                                    Canvas.Top="200"
                                    Width="56"
                                    Height="0"
                                    Fill="{StaticResource RobotArmGradient}" />

                                <!--  小臂 Arm2_2 (嵌套在 Arm2_1 内部，相对 ZIndex 10)  -->
                                <Canvas
                                    x:Name="Arm2_2"
                                    Canvas.Left="0"
                                    Canvas.Top="200"
                                    Panel.ZIndex="10"
                                    RenderTransformOrigin="0,0">
                                    <Canvas.RenderTransform>
                                        <TransformGroup>
                                            <TranslateTransform />
                                            <ScaleTransform ScaleX="-1" />
                                            <!--  rename and bind  -->
                                            <RotateTransform x:Name="Arm2_2_Rotate" Angle="{Binding Arm2_2Angle, RelativeSource={RelativeSource AncestorType=UserControl}}" />
                                        </TransformGroup>
                                    </Canvas.RenderTransform>

                                    <!--  小臂底部圆  -->
                                    <Ellipse
                                        Canvas.Left="-28"
                                        Canvas.Top="-28"
                                        Width="56"
                                        Height="56"
                                        Fill="{StaticResource RobotJointGradient}"
                                        Stroke="#FF666666"
                                        StrokeThickness="1" />

                                    <!--  小臂主体  -->
                                    <Path
                                        Data="M 28 0 L 28 234 L -28 234 L -28 0 A 28 28 90 0 1 28 0 Z"
                                        Fill="{StaticResource RobotArmGradient}"
                                        Stroke="#FF666666"
                                        StrokeThickness="1" />

                                    <!--  小臂上端  -->
                                    <Rectangle
                                        Canvas.Left="-28"
                                        Canvas.Top="234"
                                        Width="56"
                                        Height="0"
                                        Fill="{StaticResource RobotArmGradient}" />

                                    <!--  工具 Arm2_3 (嵌套在 Arm2_2 内部，相对 ZIndex 20)  -->
                                    <Canvas
                                        x:Name="Arm2_3"
                                        Canvas.Left="0"
                                        Canvas.Top="236"
                                        Panel.ZIndex="20"
                                        RenderTransformOrigin="0,0">
                                        <Canvas.RenderTransform>
                                            <TransformGroup>
                                                <TranslateTransform />
                                                <ScaleTransform ScaleX="1" />
                                                <!--  rename and bind  -->
                                                <RotateTransform x:Name="Arm2_3_Rotate" Angle="{Binding Arm2_3Angle, RelativeSource={RelativeSource AncestorType=UserControl}}" />
                                            </TransformGroup>
                                        </Canvas.RenderTransform>

                                        <!--  工具底座  -->
                                        <Path
                                            Data="M 38 -80 L -38 -80 L -38 0 A 38 38 270 0 0 38 1 Z"
                                            Fill="{StaticResource RobotArmGradient}"
                                            Stroke="#FF666666"
                                            StrokeThickness="1" />

                                        <!--  工具叉形  -->
                                        <Path
                                            Canvas.Left="0"
                                            Canvas.Top="-80"
                                            Data="M -20 0 L -20 -120 L -30 -140 L -30 -220 L -20 -220 L -10 -180 L 10 -180 L 20 -220 L 30 -220 L 30 -140 L 20 -120 L 20 0 Z"
                                            Fill="{StaticResource ToolFill}"
                                            Stroke="#FF666666"
                                            StrokeThickness="1" />
                                        <local:WaferControl
                                            x:Name="WaferCtrl_Upper"
                                            Canvas.Left="-60"
                                            Canvas.Top="-300"
                                            Width="120"
                                            Height="120"
                                            FontColor="Black"
                                            Status="Completed"
                                            WaferFontFamily="Consolas"
                                            WaferFontSize="18"
                                            WaferFontWeight="Bold"
                                            WaferLabel="LOT123-25"
                                            WaferVisible="True" />

                                    </Canvas>
                                </Canvas>
                            </Canvas>
                        </Canvas>
                    </Canvas>
                </Grid>
            </Viewbox>

        </Grid>
    </Viewbox>
</UserControl>
